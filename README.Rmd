---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# HotellingEllipse

<!-- badges: start -->
<!-- badges: end -->

The HotellingEllipse package computes the Hotelling's T-squared Statistic and provides the confidence ellipse axis parameters for a bivariate scatter plot, at 95% and 99% confidence levels.

## Installation

You can install the released version of HotellingEllipse from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("HotellingEllipse")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ChristianGoueguel/HotellingEllipse")
```
## Example

Example with principal component analysis (PCA) from laser-induced breakdown spectroscopy (LIBS) spectra:

```{r message=FALSE, warning=FALSE}
library(HotellingEllipse)
library(tidyverse)
devtools::load_all()
```

Load LIBS dataset into R session.

```{r}
data("LIBS_spec")
```

Perform principal component analysis.

```{r}
set.seed(123)
pca_mod <- LIBS_spec %>%
  select(where(is.numeric)) %>%
  FactoMineR::PCA(scale.unit = FALSE, graph = FALSE)
```

Extract PCA scores.

```{r}
pca_scores <- pca_mod %>%
  pluck("ind", "coord") %>%
  as_tibble() %>%
  print()
```

Now we can calculate Hotelling's T-squared statistic for the first two components with the parameters of the axis of the confidence ellipse.

```{r}
res_Tsq <- HotellingEllipse(data = pca_scores, k = 2, pcx = 1, pcy = 2)
```

```{r}
str(res_Tsq)
```

Retrieve ellipse parameters at 99% confidence level.

```{r}
a1 <- pluck(res_Tsq, "Ellipse", "a1")
b1 <- pluck(res_Tsq, "Ellipse", "b1")
```

Retrieve ellipse parameters at 95% confidence level.

```{r}
a2 <- pluck(res_Tsq, "Ellipse", "a2")
b2 <- pluck(res_Tsq, "Ellipse", "b2")
```

Retrieve Hotelling's T-squared statistic.

```{r}
T2 <- pluck(res_Tsq, "Tsquared", "statistic")
```

```{r}
pca_scores %>%
  ggplot(aes(x=Dim.1, y=Dim.2)) +
  ggforce::geom_ellipse(aes(x0=0, y0=0, a=a1, b=b1, angle=0), size=.5, linetype="dotted") + 
  ggforce::geom_ellipse(aes(x0=0, y0=0, a=a2, b=b2, angle=0), size=.5, linetype="dashed") +
  geom_point(aes(fill=T2), alpha=1, shape=21, size=3, color="black") +
  scale_fill_viridis_c(option="viridis") +
  geom_hline(yintercept=0, linetype="solid", color="black", size=.2) +
  geom_vline(xintercept=0,linetype="solid", color="black", size=.2) +
  labs(x="t1", y="t2", fill="T2 stats")
```







